'use strict';function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function f(g,h){try{var j=b[g](h),k=j.value}catch(l){return void d(l)}return j.done?void c(k):Promise.resolve(k).then(function(l){f('next',l)},function(l){f('throw',l)})}return f('next')})}}$(function(){var a=$('#offlineDownloadLink'),b=$('#offlineDownloadIsPublicCheckbox'),c=$('#offlineDownloadModalBtn'),d=$('#offlineDownloadModal');c.click(function(){var f=_asyncToGenerator(regeneratorRuntime.mark(function g(h){var j,k,l,m,n,o;return regeneratorRuntime.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:if(h.preventDefault(),j=a.val(),k=b.prop('checked'),REGEXP.URL.test(j)){q.next=8;break}setElementClass(a,'is-invalid'),showAlert('\u8F93\u5165\u94FE\u63A5\u65E0\u6548'),q.next=21;break;case 8:return q.prev=8,q.next=11,postAsync('/offlineDownload/downloadLink',{link:j,isPublic:k});case 11:l=q.sent,m=l.status,n=l.msg,o=l.data,showAlert(n,m),m&&(a.val(''),hideModal(d)),q.next=21;break;case 17:q.prev=17,q.t0=q['catch'](8),showAlert(MSG.ERROR),console.log(q.t0);case 21:case'end':return q.stop();}},g,void 0,[[8,17]])}));return function(){return f.apply(this,arguments)}}())}),$(_asyncToGenerator(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,Promise.all([getFileListAsync(),getLoginEmailAsync()]);case 3:c.next=8;break;case 5:c.prev=5,c.t0=c['catch'](0),console.log(c.t0);case 8:case'end':return c.stop();}},a,void 0,[[0,5]])}))),$(function(){var a=$('#refreshFileListBtn');a.click(function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function c(d){return regeneratorRuntime.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return d.preventDefault(),g.next=3,getFileListAsync();case 3:case'end':return g.stop();}},c,void 0)}));return function(){return b.apply(this,arguments)}}())}),$(function(){var a=$('#uploadControl'),b=$('#uploadProgressBar'),c=$('#uploadIsPublicCheckbox'),d=$('#uploadModalBtn');d.click(function(f){f.preventDefault(),a.prop('disabled',!0);for(var g=new FormData,h=0;h<a[0].files.length;h++)g.append('file',a[0].files[h]);g.append('isPublic',c.prop('checked')),$.ajax({xhrFields:{withCredentials:!0},url:'https://'+DOMAIN+'/server/upload',method:'post',data:g,processData:!1,contentType:!1,async:!0,success:function(){var j=_asyncToGenerator(regeneratorRuntime.mark(function k(l){var m,n;return regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return m=l.status,n=l.msg,showAlert(n,m),a.prop('disabled',!1),p.next=5,getFileListAsync();case 5:case'end':return p.stop();}},k,void 0)}));return function success(){return j.apply(this,arguments)}}(),error:function error(j){showAlert(MSG.ERROR),a.prop('disabled',!1),console.log(j)},xhr:function xhr(){var j=$.ajaxSettings.xhr();return j.upload&&j.upload.addEventListener('progress',function(k){if(k.lengthComputable){var l=100*(k.loaded/k.total);b.css('width',l+'%'),a.change(function(){b.css('width','0%')})}},!1),j}})})}),$(function(){var a=$('.modal');a.on('hidden.bs.modal',function(b){Object.is($(b.target).find('form')[0],void 0)||$(b.target).find('form')[0].reset()})}),$(function(){var a=$('#downloadBtn');a.click(function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function c(d){var f,g,h,j,k,l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(d.preventDefault(),f=$('input[type=radio]:checked'),0!==f.length){n.next=6;break}showAlert('\u8BF7\u9009\u62E9\u8981\u4E0B\u8F7D\u7684\u6587\u4EF6'),n.next=24;break;case 6:if(!(1<f.length)){n.next=10;break}showAlert('\u4F60\u600E\u4E48\u9009\u4E2D\u591A\u4E2A\u6587\u4EF6\u7684\uFF0C\u4F5C\u5F0A\u4E86\u5427'),n.next=24;break;case 10:return g=f.attr('data-fileid'),n.prev=11,n.next=14,getAsync('/download/getDownloadLink',{fileId:g});case 14:h=n.sent,j=h.status,k=h.msg,l=h.data,showAlert(k,j),j&&download(l.downloadLink),n.next=24;break;case 20:n.prev=20,n.t0=n['catch'](11),showAlert(MSG.ERROR),console.log(n.t0);case 24:case'end':return n.stop();}},c,void 0,[[11,20]])}));return function(){return b.apply(this,arguments)}}())}),$(function(){var a=$('#deleteBtn'),b=$('#deleteModal'),c=$('#deleteModalBtn'),d=$('#deleteFileName'),f=null;a.click(function(g){if(g.preventDefault(),f=$('input[type=radio]:checked'),0===f.length)showAlert('\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u6587\u4EF6');else if(1<f.length)showAlert('\u4F60\u600E\u4E48\u9009\u4E2D\u591A\u4E2A\u6587\u4EF6\u7684\uFF0C\u4F5C\u5F0A\u4E86\u5427');else{var h=f.parent().siblings('.fileName');d.text(h.text()),b.modal('show')}}),c.click(function(){var g=_asyncToGenerator(regeneratorRuntime.mark(function h(j){var k,l,m,n,o;return regeneratorRuntime.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return j.preventDefault(),k=f.attr('data-fileid'),q.prev=2,q.next=5,postAsync('/delete',{fileId:k});case 5:return l=q.sent,m=l.status,n=l.msg,o=l.data,showAlert(n,m),b.modal('hide'),q.next=11,getFileListAsync();case 11:q.next=17;break;case 13:q.prev=13,q.t0=q['catch'](2),showAlert(MSG.ERROR),console.log(q.t0);case 17:case'end':return q.stop();}},h,void 0,[[2,13]])}));return function(){return g.apply(this,arguments)}}())});